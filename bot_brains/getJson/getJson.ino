#include <WiFi.h>;
#include "heltec.h"
#include "WiFi.h"
#include <HTTPClient.h>;
#include <ArduinoJson.h>;


const char* ssid = "TP-Link_A36A";
const char* password = "codner1234";


void setup() {

  //Setup Heltec display
  pinMode(LED,OUTPUT);
  digitalWrite(LED,HIGH);
  Heltec.begin(true /*DisplayEnable Enable*/, false /*LoRa Enable*/, true /*Serial Enable*/);
  delay(300);

  //Start Serial
  Serial.begin(115200);
  WiFi.begin(ssid, password);
  Serial.print("Connecting to Wifi");
  
  //Heltec.display -> drawString(0, 0, "Connecting to Wifi");
  //Heltec.display -> display();


  while(WiFi.status() != WL_CONNECTED){
    Serial.print(".");
    
    Heltec.display -> drawString(1, 1*9, ".");
    Heltec.display -> display();
    delay(500);
  }

  Serial.println("\nConnected to the Wifi network");
  Heltec.display -> drawString(2, 2*9, "\nConnected to the Wifi network");
  
  Serial.print("IP Address: ");
  Heltec.display -> drawString(3, 3*9, "IP Address: ");
  
  Serial.println(WiFi.localIP());
  
  //Heltec.display -> drawString(4, 4*9, String(WiFi.localIP()));
  Heltec.display -> display();

}

void executeCommands(String id, String cmd){

  // Assign required variables
  const String newCmdStatus = "EXECUTED";

  //Execute Given Commands
  if(cmd == "MOVE_UP"){
    
  }else if(cmd == "MOVE_DOWN"){
  }else if(cmd == "MOVE_LEFT"){
  }else if(cmd == "MOVE_RIGHT"){
  }else if(cmd == "VIBRATE_DEFAULT"){
  }else if(cmd == "BLINK_0"){
  }else if(cmd == "WAIT_0"){
  }else if(cmd == "JUMP_0"){
  }else if(cmd == "SCAN_0"){
  }else if(cmd == "SIGNAL_0"){
  }else if(cmd == "GRAB_0"){
    
  }

  //Update Status of given commands
  //<patch commands go here>
}

void loop() {
  if(WiFi.status() == WL_CONNECTED){
    long rnd = random(1, 10);
    const char* robot_id = "ASDF124";
    HTTPClient client;

    client.begin("http://lonaris.ca:3000/api/arc_db/arc_cmd_table/cmd_status/UNEXECUTED/r_usr_an_id/"+String(robot_id));
    int httpCode = client.GET();

    if(httpCode > 0){
      String payload = client.getString();
      Serial.println("\n Statuscode: " + String(httpCode));
      Serial.println(payload);

      //deserialize json
      char json[500];
      /*payload.replace(" ", "");
      payload.replace("\n", "");
      payload.trim();
      payload.remove(0,1);*/
      payload.toCharArray(json, 500);

      String test = "[{\"cmd_id\":257,\"cmd_an_id\":\"124958875dc42\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT123\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12349\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-13T05:04:29.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":258,\"cmd_an_id\":\"74795d5206e4d\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT123\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12350\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-13T05:04:52.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":259,\"cmd_an_id\":\"441afab5bd467\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT123\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12352\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-13T05:04:53.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":260,\"cmd_an_id\":\"ee9b1061ec315\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT123\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12351\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-13T05:04:53.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":261,\"cmd_an_id\":\"10e74aa02bba4\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT123\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12349\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-13T05:04:54.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":262,\"cmd_an_id\":\"eeb1bdc50be47\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT123\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12348\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-13T05:04:54.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":263,\"cmd_an_id\":\"dccaa04254656\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT123\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12345\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-13T05:04:55.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":264,\"cmd_an_id\":\"97b1ed314b65e\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT123\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12347\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-13T05:04:56.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":265,\"cmd_an_id\":\"446677c870b47\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT123\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12346\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-13T05:04:56.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":266,\"cmd_an_id\":\"48f9839c03c8f\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT123\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-13T05:04:57.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":292,\"cmd_an_id\":\"5ed9209a0894f20210514021846\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT125\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12347\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T02:18:46.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":293,\"cmd_an_id\":\"1bc4c96ac2f8e20210514021901\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT125\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12349\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T02:19:01.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":294,\"cmd_an_id\":\"ccc0061a6c97b20210514021902\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT125\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12350\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T02:19:02.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":295,\"cmd_an_id\":\"181e65580e9b120210514021903\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT125\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12352\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T02:19:03.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":296,\"cmd_an_id\":\"c8257c3b78ed820210514021904\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT125\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12350\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T02:19:04.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":297,\"cmd_an_id\":\"d29ab26c340c820210514021908\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT125\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"fd35bd0bea\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T02:19:08.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":316,\"cmd_an_id\":\"2221206d6b70720210514051648\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12346\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:16:48.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":317,\"cmd_an_id\":\"b6de7b350471c20210514051649\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12347\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:16:49.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":318,\"cmd_an_id\":\"6fa455822d61520210514051649\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12348\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:16:49.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":319,\"cmd_an_id\":\"14b3cda6eee4a20210514051650\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12345\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:16:50.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":320,\"cmd_an_id\":\"976d3028893cd20210514051658\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:16:58.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":321,\"cmd_an_id\":\"3316eb344c2be20210514051701\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:01.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":322,\"cmd_an_id\":\"1a611d7c2f56c20210514051701\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:01.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":323,\"cmd_an_id\":\"4e2520f72260320210514051702\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:02.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":324,\"cmd_an_id\":\"2859c09c46ab920210514051702\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:02.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":325,\"cmd_an_id\":\"bb24e0bd5d72920210514051703\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:03.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":326,\"cmd_an_id\":\"015aa9c5bbb9e20210514051704\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12348\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:04.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":327,\"cmd_an_id\":\"c3f23ac831ca520210514051705\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12345\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:05.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":328,\"cmd_an_id\":\"0ce6d16545c0f20210514051705\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12347\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:05.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":329,\"cmd_an_id\":\"b1ed0d18c5d4c20210514051707\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12346\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:07.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":330,\"cmd_an_id\":\"627abddebf82420210514051708\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:08.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":331,\"cmd_an_id\":\"adf05b7f9b6ff20210514051709\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:09.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":332,\"cmd_an_id\":\"979b8d9842c6a20210514051710\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:10.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":333,\"cmd_an_id\":\"b4ed06525f0ff20210514051711\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:11.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":334,\"cmd_an_id\":\"498b3d0ace75720210514051712\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:12.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":335,\"cmd_an_id\":\"f834ae0ae4b520210514051712\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:12.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":336,\"cmd_an_id\":\"1277deae200fb20210514051713\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:13.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":337,\"cmd_an_id\":\"cd45fa753b47320210514051713\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:13.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":338,\"cmd_an_id\":\"1c29e2534f8af20210514051718\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12346\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:18.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":339,\"cmd_an_id\":\"49c0739f1510620210514051719\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12348\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:19.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":340,\"cmd_an_id\":\"9202c5f9a5c5d20210514051721\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12347\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:21.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":341,\"cmd_an_id\":\"50825604d660a20210514051721\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12345\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:21.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":342,\"cmd_an_id\":\"df17fdc7f43ca20210514051722\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12348\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:22.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":343,\"cmd_an_id\":\"4c036c238206820210514051723\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:23.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":344,\"cmd_an_id\":\"86e41805d624320210514051724\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:24.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":345,\"cmd_an_id\":\"39e4b5e0060e20210514051724\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:24.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":346,\"cmd_an_id\":\"32b0130340b9620210514051725\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:25.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":347,\"cmd_an_id\":\"2dc5234326a4920210514051725\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:25.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":348,\"cmd_an_id\":\"d307e9db0d21b20210514051726\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:26.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":349,\"cmd_an_id\":\"cc8612fbd875920210514051726\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:26.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":350,\"cmd_an_id\":\"83ea8c74491b820210514051727\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:27.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":351,\"cmd_an_id\":\"821242f42cd320210514051727\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:27.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":352,\"cmd_an_id\":\"4d9b153c882ac20210514051727\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:27.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":353,\"cmd_an_id\":\"45d106fd7fa5720210514051728\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:28.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":354,\"cmd_an_id\":\"988d405cbc54e20210514051728\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:28.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":355,\"cmd_an_id\":\"2ba3ee84c0c2620210514051728\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"0\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:28.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":356,\"cmd_an_id\":\"0f14999c6bf3a20210514051730\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12348\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:30.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":357,\"cmd_an_id\":\"d60a041d9b8b620210514051730\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12348\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:30.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":358,\"cmd_an_id\":\"8c393a753593c20210514051731\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12345\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:31.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":359,\"cmd_an_id\":\"51fd2d5b7118520210514051731\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12345\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:31.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":360,\"cmd_an_id\":\"35a1c3e20ad7320210514051733\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12346\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:33.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"},{\"cmd_id\":361,\"cmd_an_id\":\"927ee8f4e563520210514051733\",\"r_usr_an_id\":\"ASDF124\",\"c_usr_an_id\":\"QWERT124\",\"r_usr_code_name\":\"ARCANE2\",\"cmd_exec_name\":\"ABC12346\",\"cmd_exec_params\":\"0\",\"cmd_exec_data\":\"0\",\"cmd_status\":\"UNEXECUTED\",\"cmd_op1\":\"0\",\"cmd_op2\":\"0\",\"cmd_op3\":\"0\",\"cmd_date_created\":\"2021-05-14T05:17:33.000Z\",\"cmd_date_executed\":\"1970-01-01T00:00:00.000Z\"}]";

      DynamicJsonDocument doc(24576);
      deserializeJson(doc, test);
      
      
      for (JsonObject elem : doc.as<JsonArray>()) {
      
        //int cmd_id = elem["cmd_id"]; 
        const char* cmd_an_id = elem["cmd_an_id"]; 
       
        Serial.println(String(cmd_an_id) + "\n");
      }
      
      client.end();
      
      
    }else{
       Serial.println("Error on HTTP request.");
    }
    
    /*Heltec.display -> clear();
    Serial.println("You can try and ping me.");
    
    Heltec.display -> drawString(0, 1*9, "You can try and ping me.");
    Heltec.display -> drawString(0, 2*9, "IP Address: ");
    Heltec.display -> drawString(60, 2*9, WiFi.localIP().toString());

    
    Heltec.display -> display();
    delay(5000);*/
  }else{
    Serial.println("Connection Lost...");  
    Heltec.display -> clear();
    
    Heltec.display -> drawString(0, 0, "Connection Lost...");
    Heltec.display -> display();
  }

  delay(10000);

}

